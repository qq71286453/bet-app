<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>下注紀錄系統</title>

<style>
body{
    font-family: Arial, sans-serif;
    background:#111;
    color:#fff;
    text-align:center;
    padding:20px;
}

input,button{
    padding:8px;
    margin:4px;
    font-size:16px;
}

button{
    cursor:pointer;
}

.win-text{ color:#00ff88; }
.lose-text{ color:#ff4d4d; }

.profit-green{ color:#00ff88; }
.profit-red{ color:#ff4d4d; }
.profit-zero{ color:#ccc; }

.rate-high{ color:#00ff88; }
.rate-mid{ color:#ffaa00; }
.rate-low{ color:#ff4d4d; }

.record-item{
    margin:4px 0;
}

.section{
    margin-top:15px;
}
</style>
</head>

<body>

<h2>下注紀錄系統</h2>

<div class="section">
本金：<input type="number" id="bankroll" value="1000">
</div>

<div class="section">
賠率：<input type="number" id="odds" value="2" step="0.01">
下注%：<input type="number" id="betPercent" value="10">
<button onclick="auto34()">3/4</button>
<button onclick="auto23()">2/3</button>
</div>

<div class="section">
<button onclick="settle(true,'normal')">勝</button>
<button onclick="settle(false,'normal')">敗</button>
<button onclick="settle(true,'half')">加勝</button>
<button onclick="settle(false,'half')">加敗</button>
<button onclick="settle(true,'cat')">貓勝</button>
<button onclick="settle(false,'cat')">貓敗</button>
<button onclick="undo()">Undo</button>
</div>

<div class="section" id="stats"></div>

<div class="section">
<h3>紀錄</h3>
<div id="records"></div>
</div>

<script>

let historyData=[];
let totalProfit=0;

let winCount=0,loseCount=0;
let halfWinCount=0,halfLoseCount=0;
let catWinCount=0,catLoseCount=0;

const recordDiv=document.getElementById("records");
const statsDiv=document.getElementById("stats");

function rateClass(rate){
    if(rate>=55) return "rate-high";
    if(rate>=50) return "rate-mid";
    return "rate-low";
}

function auto34(){
    let odds=parseFloat(document.getElementById("odds").value);
    if(!odds) return;
    let percent=(0.75/(odds-1))*100;
    document.getElementById("betPercent").value=percent.toFixed(2);
}

function auto23(){
    let odds=parseFloat(document.getElementById("odds").value);
    if(!odds) return;
    let percent=(0.6667/(odds-1))*100;
    document.getElementById("betPercent").value=percent.toFixed(2);
}

function settle(isWin,type){

    let bankroll=parseFloat(document.getElementById("bankroll").value);
    let odds=parseFloat(document.getElementById("odds").value);
    let percent=parseFloat(document.getElementById("betPercent").value);

    if(!bankroll || !odds || !percent) return;

    let bet=bankroll*(percent/100);
    let profit=0;

    if(isWin){
        profit=bet*(odds-1);
    }else{
        profit=-bet;
    }

    bankroll+=profit;
    totalProfit+=profit;

    document.getElementById("bankroll").value=bankroll.toFixed(2);

    // 統計
    if(type==="normal"){
        if(isWin) winCount++;
        else loseCount++;
    }

    if(type==="half"){
        if(isWin) halfWinCount++;
        else halfLoseCount++;
    }

    if(type==="cat"){
        if(isWin) catWinCount++;
        else catLoseCount++;
    }

    historyData.push({
        isWin,
        type,
        bet:bet.toFixed(2),
        odds:odds.toFixed(2),
        profit:profit.toFixed(2),
        remain:bankroll.toFixed(2)
    });

    render();
}

function undo(){
    if(historyData.length===0) return;

    let last=historyData.pop();

    let bankroll=parseFloat(document.getElementById("bankroll").value);
    bankroll-=parseFloat(last.profit);
    document.getElementById("bankroll").value=bankroll.toFixed(2);

    totalProfit-=parseFloat(last.profit);

    if(last.type==="normal"){
        if(last.isWin) winCount--;
        else loseCount--;
    }

    if(last.type==="half"){
        if(last.isWin) halfWinCount--;
        else halfLoseCount--;
    }

    if(last.type==="cat"){
        if(last.isWin) catWinCount--;
        else catLoseCount--;
    }

    render();
}

function render(){

    recordDiv.innerHTML="";

    historyData.forEach(r=>{
        let div=document.createElement("div");
        div.className="record-item "+(r.isWin?"win-text":"lose-text");

        let typeLabel="";
        if(r.type==="half") typeLabel="加";
        if(r.type==="cat") typeLabel="貓";

        div.textContent=
            typeLabel+
            (r.isWin?"勝":"敗")+
            " | 注:"+r.bet+
            " | 賠:"+r.odds+
            " | 損益:"+(r.profit>=0?"+":"")+r.profit+
            " | 剩:"+r.remain;

        recordDiv.appendChild(div);
    });

    let totalWins=winCount+halfWinCount+catWinCount;
    let totalLoses=loseCount+halfLoseCount+catLoseCount;
    let totalGames=totalWins+totalLoses;
    let totalRate=totalGames>0?((totalWins/totalGames)*100).toFixed(1):0;

    let halfTotal=halfWinCount+halfLoseCount;
    let halfRate=halfTotal>0?((halfWinCount/halfTotal)*100).toFixed(1):0;

    let catTotal=catWinCount+catLoseCount;
    let catRate=catTotal>0?((catWinCount/catTotal)*100).toFixed(1):0;

    let profitClass="profit-zero";
    if(totalProfit>0) profitClass="profit-green";
    if(totalProfit<0) profitClass="profit-red";

    statsDiv.innerHTML=
        "總場次："+totalGames+
        " ｜ 總勝："+totalWins+
        " ｜ 總敗："+totalLoses+
        " ｜ 總勝率：<span class='"+rateClass(Number(totalRate))+"'>"+totalRate+"%</span><br>"+
        "加場次："+halfTotal+
        " ｜ 加勝："+halfWinCount+
        " ｜ 加敗："+halfLoseCount+
        " ｜ 加勝率：<span class='"+rateClass(Number(halfRate))+"'>"+halfRate+"%</span><br>"+
        "貓場次："+catTotal+
        " ｜ 貓勝："+catWinCount+
        " ｜ 貓敗："+catLoseCount+
        " ｜ 貓勝率：<span class='"+rateClass(Number(catRate))+"'>"+catRate+"%</span><br>"+
        "總損益：<span class='"+profitClass+"'>"+totalProfit.toFixed(2)+"</span>";

    localStorage.setItem("betData",JSON.stringify({
        historyData,totalProfit,
        winCount,loseCount,
        halfWinCount,halfLoseCount,
        catWinCount,catLoseCount
    }));
}

function load(){
    let data=localStorage.getItem("betData");
    if(!data) return;

    let obj=JSON.parse(data);

    historyData=obj.historyData||[];
    totalProfit=obj.totalProfit||0;

    winCount=obj.winCount||0;
    loseCount=obj.loseCount||0;
    halfWinCount=obj.halfWinCount||0;
    halfLoseCount=obj.halfLoseCount||0;
    catWinCount=obj.catWinCount||0;
    catLoseCount=obj.catLoseCount||0;

    if(historyData.length>0){
        let last=historyData[historyData.length-1];
        document.getElementById("bankroll").value=last.remain;
    }

    render();
}

load();

</script>
</body>
</html>
